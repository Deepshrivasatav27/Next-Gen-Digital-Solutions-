{% extends "base.html" %}
{% block title %}Master Dashboard{% endblock %}
{% block content %}
<div class="container-fluid py-4">
    <h2 class="mb-4">Master Admin Dashboard</h2>
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5 class="card-title">Total Companies</h5>
                    <h2 class="mb-0">{{ total_companies }}</h2>
                    <small>{{ active_companies }} active</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">Total Users</h5>
                    <h2 class="mb-0">{{ total_users }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5 class="card-title">Total Leads</h5>
                    <h2 class="mb-0">{{ total_leads }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark">
                <div class="card-body">
                    <h5 class="card-title">Total Revenue</h5>
                    <h2 class="mb-0">₹{{ "%.2f"|format(total_revenue) }}</h2>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Plan Distribution</div>
                <div class="card-body">
                    <p><span class="badge bg-secondary">Free:</span> {{ plan_stats.free }}</p>
                    <p><span class="badge bg-primary">Basic:</span> {{ plan_stats.basic }}</p>
                    <p><span class="badge bg-success">Pro:</span> {{ plan_stats.pro }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">API Usage</div>
                <div class="card-body">
                    <h3>{{ api_usage }}</h3>
                    <p class="text-muted">Total API calls</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Quick Actions</div>
                <div class="card-body">
                    <a href="{{ url_for('master.create_company') }}" class="btn btn-primary btn-sm mb-2 w-100">Create Company</a>
                    <a href="{{ url_for('master.all_leads') }}" class="btn btn-outline-primary btn-sm w-100">View All Leads</a>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Recent Companies</div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead><tr><th>Name</th><th>Plan</th><th>Status</th></tr></thead>
                        <tbody>
                        {% for c in recent_companies %}
                        <tr>
                            <td><a href="{{ url_for('master.view_company', id=c.id) }}">{{ c.name }}</a></td>
                            <td><span class="badge bg-{{ 'success' if c.plan == 'pro' else 'primary' if c.plan == 'basic' else 'secondary' }}">{{ c.plan }}</span></td>
                            <td><span class="badge bg-{{ 'success' if c.is_active else 'danger' }}">{{ 'Active' if c.is_active else 'Inactive' }}</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="3" class="text-center text-muted">No companies yet</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Recent Payments</div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead><tr><th>Company</th><th>Amount</th><th>Date</th></tr></thead>
                        <tbody>
                        {% for p in recent_payments %}
                        <tr>
                            <td>{{ p.company_name }}</td>
                            <td>₹{{ "%.2f"|format(p.amount) }}</td>
                            <td>{{ p.created_at[:10] }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="3" class="text-center text-muted">No payments yet</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
