{% extends "base.html" %}
{% block title %}{{ company.name }}{% endblock %}
{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{{ company.name }}</h2>
        <div>
            <a href="{{ url_for('master.edit_company', id=company.id) }}" class="btn btn-outline-primary">Edit</a>
            <a href="{{ url_for('master.manage_api_keys', id=company.id) }}" class="btn btn-outline-secondary">API Keys</a>
            <form method="post" action="{{ url_for('master.toggle_company', id=company.id) }}" class="d-inline">
                <button type="submit" class="btn btn-{{ 'danger' if company.is_active else 'success' }}">
                    {{ 'Deactivate' if company.is_active else 'Activate' }}
                </button>
            </form>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Company Info</div>
                <div class="card-body">
                    <p><strong>Email:</strong> {{ company.email or '-' }}</p>
                    <p><strong>Phone:</strong> {{ company.phone or '-' }}</p>
                    <p><strong>Slug:</strong> {{ company.slug }}</p>
                    <p><strong>Created:</strong> {{ company.created_at[:10] }}</p>
                    <p><strong>Status:</strong> <span class="badge bg-{{ 'success' if company.is_active else 'danger' }}">{{ 'Active' if company.is_active else 'Inactive' }}</span></p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Plan Details</div>
                <div class="card-body">
                    <p><strong>Current Plan:</strong> <span class="badge bg-{{ 'success' if company.plan == 'pro' else 'primary' if company.plan == 'basic' else 'secondary' }}">{{ company.plan }}</span></p>
                    <p><strong>Expiry:</strong> {{ company.plan_expiry_date[:10] if company.plan_expiry_date else '-' }}</p>
                    <p><strong>Cards Limit:</strong> {{ company.cards_limit if company.cards_limit != -1 else 'Unlimited' }}</p>
                    <p><strong>White Label:</strong> {{ 'Yes' if company.white_label_enabled else 'No' }}</p>
                    <hr>
                    <form method="post" action="{{ url_for('master.update_company_plan', id=company.id) }}">
                        <div class="input-group">
                            <select name="plan" class="form-select">
                                {% for key, plan in plans.items() %}
                                <option value="{{ key }}" {{ 'selected' if key == company.plan else '' }}>{{ plan.name }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-primary">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Statistics</div>
                <div class="card-body">
                    <p><strong>Total Leads:</strong> {{ leads_count }}</p>
                    <p><strong>Total Cards:</strong> {{ cards_count }}</p>
                    <p><strong>Users:</strong> {{ users|length }}</p>
                    <p><strong>API Keys:</strong> {{ api_keys|length }}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-4 mt-2">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Users</div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead><tr><th>Username</th><th>Email</th><th>Role</th><th>Status</th></tr></thead>
                        <tbody>
                        {% for u in users %}
                        <tr>
                            <td>{{ u.username }}</td>
                            <td>{{ u.email }}</td>
                            <td>{{ u.role }}</td>
                            <td><span class="badge bg-{{ 'success' if u.is_active else 'danger' }}">{{ 'Active' if u.is_active else 'Inactive' }}</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center text-muted">No users</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Recent Payments</div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead><tr><th>Plan</th><th>Amount</th><th>Status</th><th>Date</th></tr></thead>
                        <tbody>
                        {% for p in payments %}
                        <tr>
                            <td>{{ p.plan_type }}</td>
                            <td>â‚¹{{ "%.2f"|format(p.amount) }}</td>
                            <td><span class="badge bg-{{ 'success' if p.status == 'success' else 'danger' if p.status == 'failed' else 'warning' }}">{{ p.status }}</span></td>
                            <td>{{ p.created_at[:10] }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" class="text-center text-muted">No payments</td></tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
